{% extends 'layouts/base.twig' %}

{% block content %}
    {% if cart.get_cart() is not empty %}
        <div class="container">
            <div class="row wc-block-cart wp-block-woocommerce-filled-cart-block is-large">
                <div class="col-12 ">
                    <div id="shopping-cart">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <td class="text-center">Image</td>
                                    <td class="text-start">Product</td>
                                    <td class="text-start">Quantity</td>
                                    <td class="text-end">Total</td>
                                    <td></td>
                                </tr>
                                </thead>
                                <tbody>
                                {% for cart_item_key, cart_item in cart.get_cart() %}
                                    {% set _product = cart_item['data'] %}
                                    {% set product_id = cart_item['product_id'] %}
                                    {% set product_name = _product.get_name() %}

                                    {% if _product and _product.exists() and cart_item['quantity'] > 0 and (cart_item|apply_filters('woocommerce_cart_item_visible', true, cart_item, cart_item_key)) %}
                                        <tr data-key="{{ cart_item_key }}">
                                            <td class="text-center">
                                                {% set thumbnail = _product.get_image() %}
                                                <a href="{{ function('get_permalink', product_id) }}"
                                                   class="d-block thumb-sm">
                                                    {{ thumbnail|raw }}
                                                </a>
                                            </td>
                                            <td class="text-start text-wrap">
                                                <a href="{{ function('get_permalink', product_id) }}">{{ product_name }}</a>
                                                {#                                                <small> - Date &amp; Time: 2011-02-08 22:25</small> #}
                                                {#                                                <br> #}
                                                {#                                                <small> - Reward Points: 200</small> #}
                                            </td>
                                            <td class="text-start">
                                                {% if _product.is_sold_individually() %}
                                                    {% set min_quantity = 1 %}
                                                    {% set max_quantity = 1 %}
                                                {% else %}
                                                    {% set min_quantity = 0 %}
                                                    {% set max_quantity = _product.get_max_purchase_quantity() %}
                                                {% endif %}

                                                <div class="quantity">
                                                    <div class="d-flex" style="max-width: 50px">
                                                        <button type="button" data-key="{{ cart_item_key }}"
                                                                class="js-decrement">
                                                            －
                                                        </button>

                                                        {{ function('woocommerce_quantity_input', {
                                                            'input_name': "cart[#{cart_item_key}][qty]",
                                                            'input_value': cart_item.quantity,
                                                            'max_value': max_quantity,
                                                            'min_value': min_quantity,
                                                            'product_name': product_name
                                                        }, _product, false) }}

                                                        <button type="button" data-key="{{ cart_item_key }}"
                                                                class="js-increment">
                                                            ＋
                                                        </button>
                                                    </div>
                                                </div>

                                                {% if _product.backorders_require_notification() and _product.is_on_backorder(cart_item['quantity']) %}
                                                    <p class="backorder_notification">
                                                        Available on backorder
                                                    </p>
                                                {% endif %}
                                            </td>
                                            <td class="text-end">
                                                Unit
                                                Price: {{ fn('apply_filters', 'woocommerce_cart_item_price', cart.get_product_price(_product), cart_item, cart_item_key) }}
                                                <br>
                                                {% set sub_total = cart.get_product_subtotal(_product, cart_item.quantity) %}
                                                Total: {{ fn('apply_filters', 'woocommerce_cart_item_subtotal', sub_total, cart_item, cart_item_key) }}
                                            </td>
                                            <td class="text-center">
                                                <button class="btn btn-danger js-remove-from-cart"
                                                        data-key="{{ cart_item_key }}"
                                                        type="button">
                                                    <i class="fa-solid fa-circle-xmark"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                                </tbody>
                                <tfoot id="checkout-total">
                                <tr>
                                    <td colspan="4" class="text-end"><strong>Sub-Total</strong></td>
                                    <td class="text-end">
                                        <span class="js-sub-total">{{ cart.subtotal }}</span>
                                        <span class="woocommerce-Price-currencySymbol">{{ currency_symbol }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end"><strong>Eco Tax (-2.00)</strong></td>
                                    <td class="text-end">$4.00</td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end"><strong>VAT (20%)</strong></td>
                                    <td class="text-end">$49.60</td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end"><strong>Total</strong></td>
                                    <td class="text-end">
                                        <span class="js-total">{{ cart.total }}</span>
                                        <span class="woocommerce-Price-currencySymbol">{{ currency_symbol }}</span>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>

                            <div class="col text-end">
                                <a class="btn btn-primary" href="{{ checkout_link }}">Continue</a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    {% else %}
        <div class="container">
            <div class="py-2">
                <h1>Cart is empty</h1>
            </div>
        </div>
    {% endif %}
{% endblock %}